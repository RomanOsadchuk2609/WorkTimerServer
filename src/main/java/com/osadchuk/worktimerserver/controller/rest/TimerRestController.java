package com.osadchuk.worktimerserver.controller.rest;

import com.osadchuk.worktimerserver.model.Timer;
import lombok.extern.slf4j.Slf4j;
import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
import org.springframework.security.core.Authentication;
import org.springframework.security.core.AuthenticationException;
import org.springframework.security.core.annotation.AuthenticationPrincipal;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.bind.annotation.RestController;
import sun.misc.BASE64Decoder;

import java.io.ByteArrayInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.ObjectInput;
import java.io.ObjectInputStream;
import java.util.Date;

@RestController
@RequestMapping("/timer")
@Slf4j
public class TimerRestController {

	/*private static long start = 0;

	@PostMapping("/login")
	public String login(@RequestParam(value = "authToken") String authTokenBase64) {
		try {
			BASE64Decoder decoder = new BASE64Decoder();
			byte[] authTokenBytes = decoder.decodeBuffer(authTokenBase64);
			ByteArrayInputStream bis = new ByteArrayInputStream(authTokenBytes);
			ObjectInput in = new ObjectInputStream(bis);
			Authentication authToken = (UsernamePasswordAuthenticationToken) in.readObject();
			SecurityContextHolder.getContext().setAuthentication(authToken);
			return "Login successfully!";
		} catch (AuthenticationException | IOException | ClassNotFoundException e) {
			log.error("Login failure, please try again.", e);
			return "Login failure, please try again.";
		}
	}

	@GetMapping("/get_user_icon")
	public String userIcon() {
		return "data:image/png;base64,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";
	}


	@PostMapping("/create")
	@ResponseBody
	public Timer createNewTimer(@AuthenticationPrincipal UserDetails userDetails,
	                            @RequestParam(value = "performer_id") long performerId,
	                            @RequestParam(value = "starttime") long starttime) {
		Timer timer = new Timer();
		timer.setPerformerId(performerId);
		TimerRestController.start = starttime;
		Date start = new Date();
		start.setTime(starttime);
		timer.setStarttime(start);
		return timer;
	}

	@PostMapping("/stop")
	@ResponseBody
	public Timer stopWork(@AuthenticationPrincipal UserDetails userDetails,
	                      @RequestParam(value = "timer_id") long timerId,
	                      @RequestParam(value = "endtime") long endtime) {
		Timer timer = new Timer();
		Date start = new Date();
		start.setTime(TimerRestController.start);
		timer.setStarttime(start);
		Date end = new Date();
		end.setTime(endtime);
		timer.setEndtime(end);
		return timer;
	}

	@PostMapping("/save_screenshot")
	@ResponseBody
	public void saveScreenShot(@AuthenticationPrincipal UserDetails userDetails,
	                           @RequestParam(value = "timer_id") long timerId,
	                           @RequestParam(value = "screenshot") String base64ScreenShot,
	                           @RequestParam(value = "date") long date) throws IOException {
		log.debug("Screenshot:{}", base64ScreenShot);
//		System.out.println(base64ScreenShot);
		*//*String str = base64ScreenShot;pg
		byte[] base64Val;
		BASE64Decoder decoder = new BASE64Decoder();
		base64Val = decoder.decodeBuffer(base64ScreenShot);
		ByteArrayInputStream bis = new ByteArrayInputStream(base64Val);

		*//**//*Date currentDate = new Date();
		currentDate.setTime(date);
		Timer timer = timerService.findOne(timerId);
		timer.setEndtime(currentDate);
		Timer saved = timerService.save(timer);*//**//*

		writeScreenshotIntoFile(bis, timerId, date);
		//new SaveScreenShotThread(bis,timerId,date).start();

		bis.close();*//*
	}


	private void writeScreenshotIntoFile(InputStream img, long timerId, long date) {
		//Timer timer = timerService.findOne(timerId);
		*//*long performerId = timerService.findPerformerIdByTimerId(timerId);
		long taskId = performerService.findTaskIdByPerformerId(performerId);
		long projectId = taskService.findProjectIdByTaskId(taskId);
		String username = timerService.findUsernameByTimerId(timerId);
		SimpleDateFormat dateFormat = new SimpleDateFormat("dd.MM.yyyy_HH-mm");
		Date screenshotDate = new Date();
		screenshotDate.setTime(date);
		String simpleDate = dateFormat.format(screenshotDate);
		String fileName ="taskId_"+taskId+"_timerId_"+timerId+"_"+username+"_"+simpleDate+".jpg";
		screenshotStorageService.store(img, projectId, taskId, fileName);
*//*

	}*/


}
